{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Take Exam</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{% static 'exams/styles.css' %}" rel="stylesheet">
    

</head>
<body class="takeexam-page">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Online Exam Portal</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'dashboard' %}">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <h2 class="text-center">{{ exam.title }}</h2>
        <p class="text-center text-muted">{{ exam.description }}</p>
        <div id="timer"></div>
        <hr>

        <form method="post" action="{% url 'submit_exam' exam.id %}">
            {% csrf_token %}
            {% for question in exam.questions.all %}
            <div class="mb-4">
                <h5>Q{{ forloop.counter }}: {{ question.text }}</h5>

                {% for option in question.options.all %}
                <div class="form-check">
                    <input class="form-check-input" type="radio" 
                            name="question_{{ question.id }}" 
                            value="{{ option.id }}" required>
                    <label class="form-check-label">{{ option.text }}</label>
                </div>
                {% endfor %}
            </div>
            {% endfor %}


            <button type="submit" class="btn btn-success w-100">Submit Exam</button>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Timer: 10 minutes
        let timeLeft = {{ exam.duration }} * 60;

        function startTimer() {
            let timerInterval = setInterval(function() {
                let minutes = Math.floor(timeLeft / 60);
                let seconds = timeLeft % 60;
                $('#timer').text(`Time Left: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`);

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert("Time is up! Submitting your exam.");
                    $('form').submit();
                }
                timeLeft--;
            }, 1000);
        }

        $(document).ready(startTimer);
    </script>
</body>
</html>
